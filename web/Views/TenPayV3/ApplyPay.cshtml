@{
    Layout = null;
}


<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
    <meta name="renderer" content="webkit" />
    <title>活动报名支付</title>
    <link rel="stylesheet" href="/h5/css/public.css">
    <link rel="stylesheet" href="/h5/css/orderPay.css">
</head>

<body>
    <input type="text" id="url" value="@ViewBag.ReturnUrl"  style="display:none"/>
    <table class="downloadbox" cellpadding="0" cellspacing="0">
        <tr>
            <td>
                <div class="image">
                    <img src="/h5/img/logo.png">
                </div>
            </td>
            <td>
                <h2>青创汇 / 为创业者而生</h2>
                <p>
                    <i class="fa fa-star"></i>
                    <i class="fa fa-star"></i>
                    <i class="fa fa-star"></i>
                    <i class="fa fa-star"></i>
                    <i class="fa fa-star"></i>
                    <strong onclick="godown()">10万人下载</strong>
                </p>
            </td>
            <td><a onclick="godown()">立即下载</a></td>
        </tr>
    </table>
    <!-- 主内容区 模板渲染 -->
    <div class="container">
        <div class="order_title">
            <p>订单号：<strong>@ViewBag.OrderNo</strong></p>
            <span>微信活动报名</span>
        </div>
        <div class="pay_mode">
            <h2>请选择支付方式</h2>
            <ul>
                <li class="active">
                    <img src="/h5/img/icon/wxzf.png"><span>微信</span></li>
                <li>
                    <img src="/h5/img/icon/amount.png"><span>账户余额支付</span></li>
            </ul>
            <p>需支付金额: @ViewBag.PayMoney 元</p>
        </div>
        <a class="btn_ok" id="getBrandWCPayRequest" href="javascript:void(0);" target="_blank">立即支付</a>
    </div>

    <script src="/content/js/jquery.min.js"></script>
    <script src="https://res.mail.qq.com/mmr/static/lib/js/lazyloadv3.js" type="text/javascript"></script>
    <script src="https://res.wx.qq.com/open/js/jweixin-1.1.0.js" type="text/javascript"></script>
    <script type="text/javascript">
        // 当微信内置浏览器完成内部初始化后会触发WeixinJSBridgeReady事件。
        document.addEventListener('WeixinJSBridgeReady', function onBridgeReady() {
            //公众号支付
            jQuery('a#getBrandWCPayRequest').click(function (e) {
                WeixinJSBridge.invoke('getBrandWCPayRequest', {
                    "appId": "@ViewData["appId"]", //公众号名称，由商户传入
                    "timeStamp": "@ViewData["timeStamp"]", //时间戳
                    "nonceStr": "@ViewData["nonceStr"]", //随机串
                    "package": "@Html.Raw(ViewData["package"])",//扩展包
                    "signType": "MD5", //微信签名方式:1.sha1
                    "paySign": "@ViewData["paySign"]" //微信签名
                }, function (res) {

                    if (res.err_msg == "get_brand_wcpay_request:ok") {
                        alert("微信支付成功!");
                        // location.href='/relay/share?OrderNo=@ViewData["orderno"]';
                        var url = $("#url").val();

                        location.href = url;
                    } else if (res.err_msg == "get_brand_wcpay_request:cancel") {
                        alert("用户取消支付!");
                    } else {
                        // alert(res.err_msg);
                        alert("支付失败!");
                    }
                    // 使用以上方式判断前端返回,微信团队郑重提示：res.err_msg将在用户支付成功后返回ok，但并不保证它绝对可靠。
                    //因此微信团队建议，当收到ok返回时，向商户后台询问是否收到交易成功的通知，若收到通知，前端展示交易成功的界面；若此时未收到通知，商户后台主动调用查询订单接口，查询订单的当前状态，并反馈给前端展示相应的界面。
                });

            });

            //WeixinJSBridge.log('yo~ ready.');

        }, true);

        function godown() {
            location.href = 'http://www.cn-qch.com/app';
        }
    </script>
</body>
</html>
