@{
    Layout = null;
}
@model web.Models.UserRegModel

<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
    <meta name="renderer" content="webkit" />
    <title>青创汇-用户注册</title>
    <link rel="stylesheet" href="/h5/css/public.css">
    <link rel="stylesheet" href="/h5/css/register.css">
</head>

<body>

    <form id="form0" class="form-horizontal" method="post" action="/wxuser/wxreg" novalidate="novalidate">
        @*@Html.AntiForgeryToken()*@
        @Html.ValidationSummary(true)
        <div class="container">
            <div class="facebox">
                @*<img src="/h5/img/yuan.png">
                <h2>用户名</h2>*@
                <div class="logo"></div>
                <div class="title"></div>
            </div>
            <div id="registerForm">
                <div class="form-group">
                    @Html.TextBoxFor(p => p.Phone, new { type = "text", @class = "phone phone-1", placeholder = "手机号码", maxlength = "11" })
                </div>
                <div class="form-group">
                    @Html.TextBoxFor(p => p.Password, new { type = "password", @class = "password", placeholder = "密码(至少六位)", maxlength = "16" })
                </div>
                <div class="form-group">
                    @Html.TextBoxFor(p => p.SafeCode, new { type = "text", @class = "validcode", placeholder = "输入验证码", maxlength = "6" })
                    <a class="getvalidcode enabled">获取验证码</a>
                </div>
                <div class="form-group">
                    @Html.TextBoxFor(p => p.TjUser, new { type = "text", @class = "phone phone-2", placeholder = "推荐人号码(选填)", maxlength = "11", @id = "txtUserPhone", @value = "@ViewBag.UserPhone" })
                </div>
                <div class="form-group">
                    <a class="btn-submit" onclick="Save()">确认注册</a>
                </div>
            </div>
            <p>已有青创汇会员信息？<a href="/wxuser/bind">去绑定</a></p>
            <p class="footer"><a>注册即表示同意《青创汇》用户协议</a></p>
        </div>
    </form>
    <script src="/h5/js/jquery.min.js"></script>
    <script src="~/H5/js/util.js"></script>
    <script src="/h5/js/register.js"></script>
    <script src="~/Scripts/jquery.form.js"></script>
    
    <script type="text/javascript">
        var phone = $("#txtUserPhone").val();
        if (phone != '') {
            $("#txtUserPhone").attr('readonly', 'true');
        }
        function Save() {
            $("#form0").ajaxSubmit({
                type: 'POST',
                url: '/wxuser/wxreg',
                data: $("#form0").serialize(),
                beforeSubmit: function () {
                    //表单提交前
                    $('input').blur();
                    var $phone = $('.phone-1'); // 用户手机号
                    var $reference = $('.phone-2'); // 推荐人号码
                    var $password = $('.password'); // 密码
                    var $validcode = $('.validcode'); // 验证码
                    var bReference = ($reference.val().trim() && validField($reference, regPhone, '', '推荐人手机号格式不正确！')) || true;

                    // 用户手机号验证
                    if (!validField($phone, regPhone, '手机号不能为空！', '用户手机号格式不正确！')) return false;
                    // 密码验证
                    if (!validField($password, regPassword, '密码不能为空！', '密码格式不正确！')) return false;
                    // 验证码验证
                    if (!validField($validcode, null, '验证码不能为空！')) return false;
                    // 推荐人验证
                    //if (!bReference) return;
                },
                success: function (msg) {
                    util.msgBox(msg.Data);
                    if (msg.type == "success") {                        
                        location.href = '/voucher/index'
                    }
                },
                error: function (data, status, e) {
                    util.msgBox('上传文件出错:' + e);
                }

            });
        }

    </script>
</body>
</html>
