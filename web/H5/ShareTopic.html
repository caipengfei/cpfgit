<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
    <meta name="renderer" content="webkit" />
    <link rel="dns-prefetch" href="//test.cn-qch.com/" />
    <link rel="dns-prefetch" href="//www.cn-qch.com/" />
    <title>动态详情</title>
    <link rel="stylesheet" href="css/public.css">
    <link rel="stylesheet" href="css/page5.css">
    <!--<script src="http://res.wx.qq.com/open/js/jweixin-1.1.0.js"></script>-->
</head>

<body>
    <div class="shade-div"></div>
    <table class="downloadbox" cellpadding="0" cellspacing="0">
        <tr>
            <td>
                <div class="image"><img src="img/logo.png"></div>
            </td>
            <td>
                <h2>青创汇 / 为创业者而生</h2>
                <p>
                    <i class="fa fa-star"></i>
                    <i class="fa fa-star"></i>
                    <i class="fa fa-star"></i>
                    <i class="fa fa-star"></i>
                    <i class="fa fa-star"></i>
                    <strong>10万人下载</strong>
                </p>
            </td>
            <td><a href="http://www.cn-qch.com/app">立即下载</a></td>
        </tr>
    </table>
    <!-- 主内容 通过模板渲染 -->
    <div class="container loading"></div>
    <!-- 主内容模板 -->
    <script type="text/html" id="contentTemplate">
    <%var imgUrl='http://www.cn-qch.com:8002/attach/images/'%>
    <%var avatorUrl='http://www.cn-qch.com:8002/attach/user/'%>
    <%var defaultAvatorUrl='img/avator.png'%>
        <header></header>
        <div class="dynamic">
            <table class="title">
                <tr>
                    <td>
                        <img src="<%=data.userAvatar?avatorUrl+data.userAvatar:defaultAvatorUrl%>"></td>
                    <td>
                        <h2><%=data.username%></h2>
                        <h3><%=data.usertype + ' ' + data.company%></h3>
                    </td>
                </tr>
            </table>
            <p class="black"><%==data.dynamicText.replace(/===/g,'<br>')%></p>
            <div class="imgbox">
                <%var len=data.dynamicThumbnailList.length%>
                <%var width=(len==1)?'100%':(len==2)?'49%':'32%'%>
                <%data.dynamicThumbnailList.forEach(function(item,index){%>
                    <img <%if(index%3==0){%>class="first"<%}%> src="<%=imgUrl+item.t_Pic_Url%>" style="width:<%=width%>">
                <%})%>
            </div>
            <%if(data.currentPosition){%>
                <p class="position"><%=data.currentPosition%></p>
            <%}%>
            <div class="tools">
                <a class="left" href="http://www.cn-qch.com/app"><i class="fa fa-share"></i></a>
                <a class="right msg" href="http://www.cn-qch.com/app"><i class="fa fa-comment"></i></a>
                <a class="right like" href="http://www.cn-qch.com/app"><i class="fa fa-heart"></i></a>
            </div>
            <p class="date"><%=data.date%></p>
        </div>
        <div class="visitor">
            <div class="box">
                <%if(data.avatarList.length==0){%>
                    <p>暂无点赞信息</p>
                <%}%>
                <%data.avatarList.forEach(function(item,index){%>
                    <a><img <%if(index%8==0){%>class="first"<%}%> src="<%=item.userAvator?avatorUrl+item.userAvator:defaultAvatorUrl%>"></a>
                <%})%>
            </div>
        </div>
        <!-- 评论列表 通过模板渲染 -->
        <div class="commentbox">
            <h2>最新评论</h2>
            <ul class="commentlist">
                <%if(data.userTalk.items.length==0){%><li>暂无</li><%}%>
                <%data.userTalk.items.forEach(function(item,index){%>
                    <li>
                        <a><img src="<%=item.userAvator?avatorUrl+item.userAvator:defaultAvatorUrl%>"></a>
                        <div>
                            <h3><%=item.userName%><span><%=item.t_Talk_FromDate%></span></h3>
                            <p><%=item.t_Talk_FromContent%></p>
                        </div>
                    </li>
                <%})%>
            </ul>
        </div>
    </script>
    <script src="js/zepto.min.js"></script>
    <script src="js/artTemplate.js"></script>
    <!--<script charset="gb2312" src="js/loader.js"></script>-->
    <script>
        var guid = GetUrlParam("Guid") || GetUrlParam("guid")||'';
        $.ajax({
            cache: false,
            dataType: 'json',
            url: 'http://120.25.106.244:9001/api/Topic/TopicInfo',
            data: {
                guid: guid
            },
            success: function(data) {
                if(data){
                    $('.container').html(template('contentTemplate',{data:data}));
                    $('.dynamic .imgbox img').css({
                        height:$('.dynamic .imgbox img').width(),
                        marginBottom: $('.imgbox img').eq(1).css('margin-left')
                    });
                    $('.visitor img,.commentlist img').each(function(){
                        var width=$(this).width();
                        $(this).css({height:width,borderRadius:width/2});
                    })
                    var s=data.dynamicText;
                    var re = /(http:\/\/[\w.\/]+[\?\=\w\&]*)(?![^<]+>)/gi;
                    $('.dynamic .black').html(s.replace(re, "<a href='$1'>$1</a>").replace(/===/g, '<br>'));
                }
                $('.container').removeClass('loading').siblings('.shade-div').remove();
                /*var title=data.username;
                var desc=data.dynamicText?data.dynamicText:'我刚在青创汇上发布了一条最新创业动态';
                desc=desc.length>20?desc.slice(0,20)+'...':desc;
                var imgUrl=$('.imgbox img').length?$('.imgbox img').eq(0).attr('src'):'http://www.cn-qch.com/h5/img/logo-.png'
                wxShare({
                    title: title,
                    desc: desc,
                    imgUrl: imgUrl
                });*/
            }
        })
        function GetUrlParam(name) {
            var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
            var r = window.location.search.substr(1).match(reg);
            if (r != null) return unescape(r[2]);
            return null;
        }
    </script>
</body>
</html>