<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
    <meta name="renderer" content="webkit" />
    <title>空间详情</title>
    <link rel="dns-prefetch" href="//test.cn-qch.com/" />
    <link rel="dns-prefetch" href="//www.cn-qch.com/" />
    <link rel="stylesheet" href="/h5/css/public.css">
    <link rel="stylesheet" href="/h5/css/sharePlace.css">
    <script src="http://res.wx.qq.com/open/js/jweixin-1.1.0.js"></script>
</head>
<body>
    <div class="container"></div>
    <footer>
        <a class="" href="http://www.cn-qch.com/app">路演</a>
        <a class="" href="http://www.cn-qch.com/app">入驻</a>
        <a class="space">预约场地</a>
    </footer>
    <div class="loading"></div>
    <script type="text/html" id="contentTemplate">
        <%var imgUrl='http://www.cn-qch.com:8002/attach/images/'%>
        <%var avatorUrl='http://www.cn-qch.com:8002/attach/user/'%>
        <%if(data.pic&&data.pic.length){%>
            <div class="banner">
                <div class="frame">
                    <div class="box">
                        <%data.pic.forEach(function(item,index){%>
                            <img src="<%=imgUrl+item.t_Pic_Url%>" alt="<%=item.t_Pic_Remark%>">
                        <%})%>
                    </div>
                </div>
                <div class="tag">
                    <%for(var i=0,len=data.pic.length;i<len;i++){%>
                    <span <%if(i==0){%>class="current"<%}%>  ></span>
                    <%}%>
                </div>
            </div>
        <%}%>
        <div class="details">
            <h2><%=data.t_Place_Name%></h2>
            <p><%=data.t_Place_OneWord%></p>
            <span>特点：<%=tips(data.t_Place_Tips)%></span>
        </div>
        <div class="pos"><%=data.t_Place_Street%></div>
        <div class="about">
            <h2>详细介绍</h2>
            <p><%==data.t_Place_Instruction.replace(/===/g,'<br>')%></p>
            <i></i>
        </div>
        <%if(data.t_Place_Policy){%>
        <div class="about policy">
            <h2>政策扶持</h2>
            <p><%==data.t_Place_Policy.replace(/===/g,'<br>')%></p>
            <i></i>
        </div>
        <%}%>
        <%if(data.t_Place_ProvideService&&data.t_Place_ProvideService.length){%>
            <div class="service">
                <h2>提供服务</h2>
                <div class="list clearfix">
                    <%data.t_Place_ProvideService.forEach(function(item,index){%>
                        <span><%=item.t_Style_Name%></span>
                    <%})%>
                </div>
            </div>
        <%}%>
        <%if(data.placeCase&&data.placeCase.length){%>
            <div class="case">
                <h2>孵化案例</h2>
                <div class="list clearfix">
                    <%data.placeCase.forEach(function(item,index){%>
                        <a>
                            <img src="<%=imgUrl+item.projectImage%>">
                            <%=item.projectName.length>5?item.projectName.slice(0,4)+'...':item.projectName%>
                        </a>
                    <%})%>
                </div>
            </div>
        <%}%>
    </script>
    <script src="/h5/js/zepto.min.js"></script>
    <script src="/h5/js/artTemplate.js"></script>
    <script src="/h5/js/util.js"></script>
    <script charset="gb2312" src="js/loader.js"></script>
    <script src="/h5/js/sharePlace.js"></script>
    <script>
        var guid = util.getUrlParam("Guid")||'';
        $(function () {
            $.ajax({
                url: "http://120.25.106.244:9001/api/Place/GetPlaceInfo",
                data: { PlaceGuid: guid },
                dataType: "json",
                success: function (res) {
                    if(res){
                        $('.container').html(template('contentTemplate',{data:res}));
                        $('.banner .tag span').length==1&&$('.banner .tag').addClass('hide');
                        document.title='空间详情 - - '+res.t_Place_Name;
                        $('.case img').each(function(){
                            $(this).css({
                                height:$(this).width(),
                                borderRadius:$(this).width()/2
                            })
                        })
                        bindEvent();
                        banner.init();
                        var title='青创汇平台入驻创客空间推荐: '+ res.t_Place_Name;
                        var text=$('.about p').text().trim();
                        var desc=res.t_Place_Name+',坐落于'+res.t_Place_Street+'，'+text;
                        var imgUrl;
                        if(res.pic){
                            if(res.pic.length){
                                imgUrl='http://www.cn-qch.com:8002/attach/images/'+res.pic[0].t_Pic_Url;
                            }else{
                                imgUrl='http://www.cn-qch.com/h5/img/logo-.png';
                            }
                        }else{
                            imgUrl='http://www.cn-qch.com/h5/img/logo-.png';
                        }
                        wxShare({title:title, desc: desc, imgUrl:imgUrl});
                        //console.log(title,desc,imgUrl)
                    }
                    $('.loading').remove();
                }
            });
        })
        template.helper('tips',function(value){
            var text='';
            if(value&&value.length){
                value.forEach(function(item,index){
                    text+='/'+item.t_Style_Name;
                })
            }else{
                return '暂无';
            }
            return text.slice(1);
        })
        function bindEvent(){
            $('.about').each(function(i){
                util.addTapEvent($(this).find('p')[0],function(el){
                    $(el).parent().toggleClass('active');
                })
                util.addTapEvent($(this).find('i')[0],function(el){
                    $(el).parent().toggleClass('active');
                })
            })
            util.addTapEvent($('footer>a.space')[0],function(el){
                $.ajax({
                    url: "http://120.25.106.244:9001/api/Place/GetPlaceStyle",
                    data: { placeGuid: guid },
                    dataType: "json",
                    success: function (res) {
                        if(res){
                            if(res.length){
                                location.href='/wx/reserveSpace.html?Guid='+guid;
                            }else{
                                util.msgBox('该空间暂未开放预约功能');
                            }
                        }else{
                            util.msgBox('该空间暂未开放预约功能');
                        }
                    }
                })
            })
        }
    </script>
</body>
</html>
